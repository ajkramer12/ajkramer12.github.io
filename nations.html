<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>eruditus12</title>
    <link rel="icon" href="img/favicon.png" type="image/png"> <!-- Personal Creation -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script>
        // Picture element HTML5 shiv
        document.createElement("picture");
        document.createElement('main');
    </script>
    <script src="js/picturefill.min.js" async></script>
</head>
<body>
<div class="container">
    <header class="row">
        <div class="col-sm-12">
            <h1>eruditus12</h1>
            <h3>Random thoughts that leaked out of my head</h3>
        </div>
    </header>

    <main class="main">
        <nav class="mainNav col-sm-12 col-md-2">
            <ul>
                <li><a href="index.html">Home / Blog</a></li>
                <li class="innerLink"><a href="nations.html">Tide of Nations</a></li>
                <li class="innerLink"><a href="celestis.html">The Celestis Project</a></li>
                <li class="endLink"><a href="britannia.html">Lords of Britannia</a></li>
            </ul>
        </nav>
        <div class="intro row">
            <div class="portraitCol col-sm-6 col-md-2">
                <picture>
                    <!--[If IE 9]<video style="display: none;"><![endif]-->
                    <source srcset="img/portrait.jpg" media="(min-width:1200px)"> <!-- https://s-media-cache-ak0.pinimg.com/originals/23/09/d9/2309d9c77a3047b12dc802a96f4b6a4b.jpg -->
                    <source srcset="img/portraitSmall.jpg" media="(min-width:696px)"> <!-- https://s-media-cache-ak0.pinimg.com/originals/23/09/d9/2309d9c77a3047b12dc802a96f4b6a4b.jpg -->
                    <!--[If IE 9]</video><![endif]-->
                    <img class="portrait" src="img/portraitDark.jpg" alt=""> <!-- https://s-media-cache-ak0.pinimg.com/originals/23/09/d9/2309d9c77a3047b12dc802a96f4b6a4b.jpg -->
                </picture>
            </div>
            <div class="col-sm-12 col-md-7">
                <h2 class="title">Tide of Nations</h2>
                <p>Tide of Nations is an interactive, RTS-style interface that allows users to experience the grand story of world history as it unfolds before them. Focusing primarily on the ever shifting ebb and flow of nations’ political borders, users are presented with a big picture view of history, eliminating the slew of details that can make history dry and boring to some. The Gestalt learning approach allows students to make connections between events, people, and places organically. And since learning is all about making connections, the information gleaned can be better retained.</p>
                <p>The goal is to bring history to those who are not naturally inclined to the subject, and to promote further research for those who are. Students may not come away knowing exactly what year the Battle of Agincourt took place or the names of all of Rome’s emperors (Things they likely wouldn’t remember unless they loved history anyway), but they will likely remember that Attila the Hun invaded Europe during the Dark Ages while the Roman Empire was beginning to crumble, and that the Celtic people used to occupy most of Western Europe until Rome and the Vikings drove them out.</p>
                <p>Like most of my projects, it is still a work in progress, but I’m always adding more, so check back often.</p>
                <p><a href="http://eruditus12.com/nations">Tide of Nations</a></p>
            </div>
        </div>
        <div id="mapRow" class="row">
            <div class="col-sm-12">
                <picture>
                    <!--[If IE 9]<video style="display: none;"><![endif]-->
                    <source srcset="img/nations/map.jpg" media="(min-width:877px)"> <!-- Personal creation (contains external images credited in the site itself) -->
                    <source srcset="img/nations/mapSmall.jpg" media="(min-width:481px)"> <!-- Personal creation (contains external images credited in the site itself) -->
                    <!--[If IE 9]</video><![endif]-->
                    <img src="img/nations/mapTiny.jpg" alt=""> <!-- Personal creation (contains external images credited in the site itself) -->
                </picture>
            </div>
        </div>
        <div class="row">
            <h2>Project Progress</h2>
        </div>
        <div class="blog row">
            <nav class="subNav col-sm-12 col-md-2">
                <div class="subNavTop">
                    <img id="subNavToggle" src="img/burgerButton.jpg" alt=""> <!-- http://www.flydigital.com.au/wp-content/uploads/2013/06/hamb1.png -->
                    <h4>Dates</h4>
                </div>
                <ul id="scroll-on-page-top">
                    <li><a class="scroll-on-page-link" href="#180216">Feb 16</a></li>
                    <li><a class="scroll-on-page-link" href="#180209">Feb 9</a></li>
                    <li><a class="scroll-on-page-link" href="#180202">Feb 2</a></li>
                    <li><a class="scroll-on-page-link" href="#180126">Jan 26</a></li>
                    <li><a class="scroll-on-page-link" href="#180125">Jan 25</a></li>
                    <li><a class="scroll-on-page-link" href="#180124">Jan 24</a></li>
                    <li><a class="scroll-on-page-link" href="#180123">Jan 23</a></li>
                </ul>
            </nav>
            <div class="col-sm-12 col-md-10">
                <!-- This and other .cards based on the Refill: Cards template -->
                <div class="cards">
                    <div id="180216" class="card">
                        <div class="card-image">
                            <img src="https://raw.githubusercontent.com/thoughtbot/refills/master/source/images/mountains.png" alt="">
                        </div>
                        <div class="card-header">
                            <h3 class="articleHeader">February 16</h3>
                        </div>
                        <div class="card-copy">
                            <h4 class="articleTitle">Into the Pan, a Trial by Fire</h4>
                            <p>Updating the map navigation from side-bump movement to panning has proved to be tricky. My initial thought was simply to unlock panning on the Google Map and send the new coordinates to my D3 map, but communication with the Google Map is one way: I can give it commands, but it won’t communicate with my program. Still though, I thought creating my own pan function would be rather straightforward:</p>
                            <ul>
                                <li>Gather coordinates of mousedown</li>
                                <li>Gather coordinates of mouseup</li>
                                <li>Calculate difference</li>
                                <li>Convert to a lat/long difference</li>
                                <li>Adjust the center of the map by that difference</li>
                            </ul>
                            <p>But alas the problem was much deeper than I anticipated.</p>
                            <p>First the obvious issue. By only capturing mouse down and mouse up, I was not defining a continuous pan. The user would drag, nothing would happen, they would let go, then suddenly the map would snap to a new position. This would be a bad affordance and jarring experience, so I used D3’s drag function instead to capture continuous x/y coordinates. Problem solved! Not quite.</p>
                            <p>For the most part, this logic worked fine, the map did move as I panned, but there were two glaring problems. One, after beginning a drag, if I moved my mouse back the way that I came, the map still moved in the initial direction until my cursor crossed the point of mousedown. Two, the further I moved away from the point of mousedown, the faster the map moved. I could only pan in about a 50px box before the map was moving so fast it was out of the screen!</p>
                            <p>I’ve improved the issue by grabbing new coordinates every pixel, so that there is not a compounded change, but the pan is still very weird to use. Then it dawned on me, I’m trying to calculate the lat/long equivalent of a pixel coordinate delta, but that conversion will be different depending on where I click on the map (i.e. It takes a lot more pixels to fill a degree of latitude in Greenland than in Europe.) So I’m going to have to tap further into the projection algorithm to make this work…</p>
                        </div>
                    </div>
                </div>
                <div class="cards">
                    <div id="180209" class="card">
                        <div class="card-image">
                            <img src="https://raw.githubusercontent.com/thoughtbot/refills/master/source/images/mountains.png" alt="">
                        </div>
                        <div class="card-header">
                            <h3 class="articleHeader">February 9</h3>
                        </div>
                        <div class="card-copy">
                            <h4 class="articleTitle">Missing Coordinates</h4>
                            <p>This week I worked on clearing out some bugs in the map display. First I dealt with an issue with the nation labels. There were times that when a nation appeared, its label would fly in from the top-left of the screen instead of growing in place as it was supposed to do. I realized that this only occurred for a few nations. After a bit of troubleshooting, I realized that the issue was not with the code, but with the data. The way the program is written, any new nations are supposed to be “primed” in the era before they actually appear. This means a tiny polygon is created as a placeholder so that the nation’s animation grows from the correct location and (apparently) so that the labels have an anchor. I added the priming polygons for the affected nations, and the issue was resolved.</p>
                            <p>The next bug was a very quick fix. I noticed that the Bavarians’ opacity increased during one of the era animations; that is never supposed to happen for any nation. It turned out that this was another data era. The Rugians layer was supposed to be replaced by the Bavarians in the given era, but I failed to remove the Rugians from the dataset, so the two layers were superimposed. I modified the Rugians’ coordinates to shrink to a pinpoint polygon as the Bavarians layer increased in size, and the problem was resolved.</p>
                            <p>Then for the real issue for the week. After adding reverse time navigation last week, I realized that in many instances nations would simply disappear as the user navigated back and forth through time. The issue only affected specific countries, but I didn’t see a single pattern as to when the errors occurred. After significant troubleshooting, I realized that part of the problem was, again, missing data. Many nations did not have the priming polygons that I mentioned earlier, but were too small to have labels, so I didn’t notice at first. However, when traveling backward in time, those priming polygons were also what caused the nations to remove themselves from the map. Without the polygons, the nations were removed from the dataset completely.</p>
                            <p>This fix still left several issues though due to a bug in the code itself. In an earlier version of the application, I had nations appearing and disappearing via opacity changes, instead of growing and shrinking. It turns out I failed to remove the code which modified opacity when a nation was removed from the map, so those nations remained invisible. Removing that code fixed the issue. Oddly enough, fixing this problem caused the Bavarians / Rugians problem to flare up again. Back to troubleshooting…</p>
                        </div>
                    </div>
                </div>
                <div class="cards">
                    <div id="180202" class="card">
                        <div class="card-image">
                            <img src="https://raw.githubusercontent.com/thoughtbot/refills/master/source/images/mountains.png" alt="">
                        </div>
                        <div class="card-header">
                            <h3 class="articleHeader">February 2</h3>
                        </div>
                        <div class="card-copy">
                            <h4 class="articleTitle">Flux Capacitors and other challenges</h4>
                            <p>This week I tackled time travel. Specifically, I added the ability to navigate backward in time in Tide of Nations. In the initial version of the application, time navigation was handled by increasing a “currentEra” variable as the next era button was clicked. In addition to updating the currentEra, the button click triggered a sequence of events that pulled information relevant to the new era from the various tables on the back-end. Most of these processes required no work for reverse navigation: Simply add a new button that decreases currentEra instead increasing it and done. However, updating the map was the tricky part.</p>
                            <p>The coordinates of the map layers are stored in various JSON files, one for each era. Initially, on program load I would read in the file for the current era and preload the one for the next era. When the next era button was clicked the coordinates in the preloaded file were compared to those in the current file, and the current file was modified to match the preloaded file. Then D3’s transition function would handle the map animations of updating the screen to match the new current coordinates. While all of this was happening the new next era file would preload.</p>
                            <p>So essentially, I had one object that kept track of the current state of the map, and one that was just sitting there, waiting to be used to update the first object. It worked pretty nicely and quickly, but it only worked in one direction.</p>
                            <p>I had already written the code to keep track of a previous era object that could be used like the next era object, so I thought all I would have to do is add some test for navigation direction and reference the appropriate file. I envisioned a sequence of three objects that would copy in tandem forward or backward depending on the direction of navigation. However, I overlooked the logic that my current era file was constantly being modified. This initially caused some interesting errors where countries would swap boundaries and change colors. Pretty, avant-garde, and somewhat psychedelic; but not the effect I was going for.</p>
                            <p>I fixed this error by creating a fourth object. Now I have three JSON objects that exist for the sole purpose of acting as blueprints for the fourth, which is the one that holds the current state of the map. As forward or back is clicked, the fourth object is compared and updated to match the previous or next object, depending on what is required. Then the sequence of three blueprint objects shifts forward or backward and the exposed endcap is filled with a new preloaded object. (e.g. Moving forward in time: Present is copied to Previous, Next is copied to Present, and Next preloaded with a new JSON file.) This updated method worked beautifully, but I wasn’t quite out of the woods yet.</p>
                            <p>There a bug that caused the currentEra variable to continue increasing if the user tried to go beyond the available eras by continuing to press Forward or Backward once an end was reached. Previously I had created a quick hack that prevented the map from updating if this happened, but now that dual-direction navigation was possible it caused some errors, so I added a boundary check to the whole update process to ensure that nothing occurred if there was no data to be displayed. I just thought though, I should have the button make a different sound if it is clicked at a data endcap…</p>
                        </div>
                    </div>
                </div>
                <div class="cards">
                    <div id="180126" class="card">
                        <div class="card-image">
                            <img src="https://raw.githubusercontent.com/thoughtbot/refills/master/source/images/mountains.png" alt="">
                        </div>
                        <div class="card-header">
                            <h3 class="articleHeader">January 26</h3>
                        </div>
                        <div class="card-copy">
                            <h4 class="articleTitle">It Begins</h4>
                            <p>Ah, the semester begins, the semester that will bring the completion of phase 1 of, Tide of Nations, my favorite personal project.</p>
                            <p>I first conceived of Tide of Nations back in 2014, after reading Colin McEvedy’s <i>The New Penguin Atlas of Medieval History</i>. I was incredibly impressed with the way that McEvedy was able to make the many simultaneous events of the history story tangible by showing their interconnectedness, and his illustrations of national boundaries gave a realness and excitement to the words on the page.</p>
                            <p>While studying McEvedy’s illustrations, my mind would frequently go back to documentaries I had seen in the past; documentaries that animated changing borders or territories. My mind would also jump to territory control games (Risk or SEGA’s Total War franchise) I had played, and everything started coming together. Why couldn’t all of history be represented with the conciseness and accuracy of McEvedy with the visual appeal of the Discovery Channel, and the engagement and immersion of Total War? Education is my passion, and this rudiment of a plan felt like a way to get students interested in a traditionally boring subject, while pulling history out of its typically siloed teaching approach.</p>
                            <p>I thought about the project periodically for about a year and a half, and finally began working on it in summer 2016. Over the course of the summer I planned the details of the project, created a foundational engine for the project and began plugging in territory data. I added enough user interaction and fluff to make it presentation worthy, but by the end of the summer I had a very pretty model that was full of holes, bugs, and incompletion. Not the best project management, but I had to give a presentation on this rudimentary application for a class, so it was not a typical development environment.</p>
                            <p>Other responsibilities put the project on hold for year, but I began working on it again after my capstone proposal was accepted. Since November, I’ve added more data to the application, began cleaning up the code a bit, and focused on finishing the Historical Figure display (the slide-out on the right) and the events dropdowns (little boxes on the left).</p>
                            <p>The Historical Figure display had two primary issues. First there was a bug where the images were not displayed properly at times, and second there was no way to handle more images than would fit in the box. I fixed the bug and set the overflow to display a scroll bar when more images exist than will fit. The latter proved to be a bit challenging. First, I had to adjust the image size so that the scroll bar would not partially cut them off. Second, this fix negated a CSS trick I was using to create the tab on the left of box. That tab technically overflows the box, so it became hidden whenever the scroll bar appeared. I had to create a new div to contain the images inside of the box that did not contain the tab. I then applied the scroll bar to that div.</p>
                            <p>The events boxes had a few enhancements needed. The application required the user to click through every box in order to close them; meaning that if they ignored the boxes and navigated to the next era, that era’s boxes would just stack on top of the previous era’s boxes, completely hidden. I added a trigger to the era advance button that cleared all events. Second, there was a bug that caused the boxes to stop advancing if one was clicked before all boxes had descended. I fixed this bug. Lastly, realizing how many event boxes there would be on completion of the entire project (every country in the world), I decided to have the boxes fall in two columns, with each column containing only certain event types. The most important categories would be in the column closer to the center of the screen. I completed the code and made the change, but quickly realized that was a very bad aesthetic choice for the limited data that the application currently contains. I commented the relevant code so that I could easily re-add it once I had more data in the system.</p>
                            <p>Next week I plan to add the ability for a user to navigate backward through time, instead of merely advancing. By the 9th, I plan to have worked out some bugs in the map engine (overlapping layers, hidden or misplaced labels, etc.). By the 16th, I will have added a new feature to the application so that it displays historically significant landmarks. The 23th should mark the completion of adding the display of historically significant cities. And finally, during the 24th through the 2nd I will work on reworking the map navigation so that users can click and drag the map rather than using the trigger points on the edge of the screen.</p>
                        </div>
                    </div>
                </div>
                <div class="cards">
                    <div id="180125" class="card">
                        <div class="card-header">
                            <h3 class="articleHeader">January 25</h3>
                        </div>
                        <div class="card-copy">
                            <h4 class="articleTitle">Capstone Rubric</h4>
                            <p>This is the first draft of the rubric that I propose be used to grade my capstone.</p>
                            <a href="files/rubric.pdf" target="_blank">Rubric</a>
                        </div>
                    </div>
                </div>
                <div class="cards">
                    <div id="180124" class="card">
                        <div class="card-header">
                            <h3 class="articleHeader">January 24</h3>
                        </div>
                        <div class="card-copy">
                            <h4 class="articleTitle">Project Milestones</h4>
                            <p>At this point I have completed much of the foundational work for the project, such as acquiring a domain and hosting, and creating a working application engine. The remainder of the project will involve fixing bugs and adding functionality. Below are my estimated completion dates for the remaining milestones of Tide of Nations.</p>
                            <ul>
                                <li>Feb 2 - Add reverse time navigation</li>
                                <li>Feb 9 - Finalize map engine</li>
                                <li>Feb 16 - Add support for Landmark display</li>
                                <li>Feb 23 - Add support for City display</li>
                                <li>Mar 2 - Finalize map navigation</li>
                                <li>Mar 9 - Finalize Interface</li>
                                <li>Mar 23 - Add training indicators to interface</li>
                                <li>Mar 6 - Finalize Cross Browser Compatability</li>
                                <li>Apr 13 - Finish Data Input for ad362</li>
                                <li>Apr 27 - Finish Data Input for ad406</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="cards">
                    <div id="180123" class="card">
                        <div class="card-header">
                            <h3 class="articleHeader">January 23</h3>
                        </div>
                        <div class="card-copy">
                            <h4 class="articleTitle">Capstone Proposal</h4>
                            <p>I'll be using this blog to post my progress on Tide of Nations for my capstone. Here is a link to my proposal.</p>
                            <a href="files/proposal.pdf" target="_blank">Proposal</a>
                        </div>
                    </div>
                </div>
    </main>
    <footer class="row">
        <div class="col-sm-12">
            <p>Copyright &copy; 2018 Amber Kramer</p>
        </div>
    </footer>
</div>
<script src="js/jquery.min.js"></script>
<script src="js/script.js"></script>
</body>
</html>